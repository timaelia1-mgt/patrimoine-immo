generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  biens Bien[]
}

model Bien {
  id     String @id @default(cuid())
  userId String

  nom        String
  adresse    String
  ville      String
  codePostal String

  typeFinancement  TypeFinancement
  montantCredit    Decimal?
  tauxCredit       Decimal?
  dureeCredit      Int?
  mensualiteCredit Decimal?

  loyerMensuel      Decimal
  chargesMensuelles Decimal

  taxeFonciere  Decimal @default(0)
  chargesCopro  Decimal @default(0)
  assurance     Decimal @default(0)
  fraisGestion  Decimal @default(0)
  autresCharges Decimal @default(0)

  // Champs d'enrichissement
  enrichissementFinancement     Boolean @default(false)
  enrichissementInvestissement  Boolean @default(false)
  enrichissementHistorique      Boolean @default(false)
  enrichissementRentabilite     Boolean @default(false)
  enrichissementCharges         Boolean @default(false)
  enrichissementLocataire       Boolean @default(false)
  enrichissementDepenses        Boolean @default(false)

  // Champs optionnels supplémentaires
  dateDebutCredit    DateTime?
  capitalRestantDu   Decimal?
  prixAchat          Decimal?
  fraisNotaire       Decimal?
  travauxInitiaux    Decimal?
  autresFrais        Decimal?
  dateAcquisition    DateTime?
  dateMiseEnLocation DateTime?
  revenusAnterieursOverride    Decimal?
  chargesAnterieuresOverride   Decimal?

  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  locataire Locataire?
  loyers    Loyer[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model Locataire {
  id           String   @id @default(cuid())
  bienId       String   @unique
  nom          String
  prenom       String
  email        String?
  telephone    String?
  dateEntree   DateTime?
  montantAPL   Decimal  @default(0) @db.Decimal(10, 2)
  modePaiement String   @default("virement") // virement, cheque, especes, prelevement
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  bien         Bien     @relation(fields: [bienId], references: [id], onDelete: Cascade)
  
  @@map("locataires")
}

model Loyer {
  id                    String   @id @default(cuid())
  bienId                String
  annee                 Int
  mois                  Int      // 0-11 (Janvier = 0, Décembre = 11)
  montantLocataire      Decimal  @db.Decimal(10, 2)
  montantAPL            Decimal  @db.Decimal(10, 2)
  payeLocataire         Boolean  @default(false)
  payeAPL               Boolean  @default(false)
  datePaiementLocataire DateTime?
  datePaiementAPL       DateTime?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  bien                  Bien     @relation(fields: [bienId], references: [id], onDelete: Cascade)
  
  @@unique([bienId, annee, mois])
  @@map("loyers")
}

enum TypeFinancement {
  CREDIT
  CASH
}

enum StatutLocataire {
  EN_PLACE
  PREAVIS
  PARTI
}
